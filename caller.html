<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Enviar Notifica√ß√£o</title>
  <script src="https://unpkg.com/html5-qrcode@2.3.8/minified/html5-qrcode.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
    #qr-reader { width: 300px; margin: auto; }
    button { padding: 10px 20px; font-size: 16px; margin-top: 20px; }
    input { padding: 8px; font-size: 16px; margin-top: 10px; width: 80%; }
  </style>
</head>
<body>
  <h2>üì≤ Enviar Notifica√ß√£o para o App</h2>

  <div id="qr-reader"></div>
  <p id="token-display">Token: <em>aguardando leitura...</em></p>
  <p id="nome-display">Nome: <em>aguardando leitura...</em></p>

  <button onclick="enviarNotificacao()">Mandar notifica√ß√£o</button>

  <script>
    let tokenLido = "";
    let nomeLido = "";

    function onScanSuccess(decodedText, decodedResult) {
      const url = new URL(decodedText);
      const params = new URLSearchParams(url.search);

      tokenLido = params.get("targetId") || "";
      nomeLido = params.get("name") || "Algu√©m";

      document.getElementById("token-display").innerHTML = "Token: <strong>" + tokenLido + "</strong>";
      document.getElementById("nome-display").innerHTML = "Nome: <strong>" + nomeLido + "</strong>";

      html5QrcodeScanner.clear(); // Para parar o scanner ap√≥s leitura
    }

    const html5QrcodeScanner = new Html5QrcodeScanner(
      "qr-reader", { fps: 10, qrbox: 250 });
    html5QrcodeScanner.render(onScanSuccess);

    async function enviarNotificacao() {
      if (!tokenLido || !nomeLido) {
        alert("Por favor, leia o QR Code primeiro.");
        return;
      }

      try {
        const resposta = await fetch("https://fireweb-sfe0.onrender.com/enviar", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ token: tokenLido, nome: nomeLido })
        });

        if (resposta.ok) {
          alert("‚úÖ Notifica√ß√£o enviada com sucesso!");
        } else {
          alert("‚ùå Erro ao enviar notifica√ß√£o.");
        }
      } catch (e) {
        console.error(e);
        alert("‚ùå Falha na comunica√ß√£o com o servidor.");
      }
    }
  </script>
</body>
</html>
