<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Notifica√ß√£o Autom√°tica</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
    button { padding: 10px 20px; font-size: 16px; margin-top: 20px; }
    .info { margin-top: 20px; font-size: 18px; }
  </style>
</head>
<body>
  <h2>üì® Enviar Notifica√ß√£o</h2>

  <div class="info">
    <p id="token-display">Token: <em>carregando...</em></p>
    <p id="nome-display">Nome: <em>carregando...</em></p>
  </div>

  <button onclick="enviarNotificacao()">Enviar Notifica√ß√£o</button>

  <script>
let tokenLido = "";
let nomeLido = "";

// ‚úÖ FUN√á√ÉO PARA DECODIFICAR CORRETAMENTE O TOKEN
function decodificarToken(token) {
  // Remove espa√ßos e decodifica URI
  return decodeURIComponent(token).replace(/\s+/g, '');
}

// Extrai os par√¢metros da pr√≥pria URL
const params = new URLSearchParams(window.location.search);
tokenLido = decodificarToken(params.get("targetId") || "");
nomeLido = params.get("name") || "Algu√©m";

// Atualiza a interface
document.getElementById("token-display").innerHTML = "Token: <strong>" + tokenLido + "</strong>";
document.getElementById("nome-display").innerHTML = "Nome: <strong>" + nomeLido + "</strong>";

// Fun√ß√£o para enviar a notifica√ß√£o
async function enviarNotificacao() {
  if (!tokenLido || !nomeLido) {
    alert("‚ùå Par√¢metros ausentes na URL.");
    return;
  }

  try {
    const resposta = await fetch("https://fireweb-sfe0.onrender.com/notify", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ 
        token: tokenLido, 
        nome: nomeLido,
        lang: params.get("lang") || "pt-br" // ‚úÖ Adiciona language
      })
    });

    if (resposta.ok) {
      alert("‚úÖ Notifica√ß√£o enviada com sucesso!");
    } else {
      alert("‚ùå Erro ao enviar notifica√ß√£o.");
    }
  } catch (e) {
    console.error(e);
    alert("‚ùå Falha na comunica√ß√£o com o servidor.");
  }
}
</script>
</body>
</html>
